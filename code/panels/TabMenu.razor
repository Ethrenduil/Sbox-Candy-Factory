@using Sandbox;
@using Sandbox.UI;
@using Eryziac.CandyFactory;
@inherits PanelComponent

<root>
    @if (IsVisible)
    {
        <div class="tabMenu">
            @for (int i = 0; i < players.Count(); i++)
            {
                <div class="player-container">
                    <img class="player-background" src="/textures/ui/scoreboard/player_@(i + 1).png" />
                    <div class="player-info player-name">
                        <p>@players[i].Name</p>
                    </div>
                    <div class="player-info player-money">
                        <p>ðŸ’¸ @players[i].GetMoney()</p>
                    </div>
                </div>
            }
        </div>
    }
</root>

@code
{

    public bool IsVisible { get; set; }
    private List<Player> players;
    private EscapeMenu escapeMenu;

    protected override void OnStart()
    {
        base.OnStart();
        IsVisible = false;
        StateHasChanged();
        escapeMenu = Scene.GetAllComponents<EscapeMenu>().FirstOrDefault();
    }
    protected override void OnUpdate()
    {
        base.OnUpdate();

        UpdateVisibility();
    }

    void UpdateVisibility()
    {
        if (Input.Down("Score") && !escapeMenu.IsPaused)
        {
            IsVisible = true;
            UpdatePlayers();
            StateHasChanged();
        } else if (Input.Released("Score"))
        {
            IsVisible = false;
            StateHasChanged();
        } else if (escapeMenu.IsPaused)
        {
            if (IsVisible)
            {
                IsVisible = false;
                StateHasChanged();
            }
        }
    }
    
    void UpdatePlayers()
    {
        players = Scene.GetAllComponents<Player>().ToList();
    }
}
